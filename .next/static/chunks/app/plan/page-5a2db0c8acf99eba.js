(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[624],{722:(e,t,a)=>{"use strict";a.d(t,{R2:()=>o,a7:()=>h,cQ:()=>c,gw:()=>d});let r="lunchplanner_token",n=()=>localStorage.getItem(r),i=e=>{localStorage.setItem(r,e)},l=()=>{localStorage.removeItem(r)},s=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=n(),r={"Content-Type":"application/json",...a?{Authorization:"Bearer ".concat(a)}:{},...t.headers||{}},i=await fetch("".concat("http://localhost:3000/api").concat(e),{...t,headers:r});if(401===i.status)throw l(),window.location.href="/login",Error("Unauthorized");let s=await i.json();if(!i.ok)throw Error(s.message||"API request failed");return s},o={register:async(e,t,a)=>{let r=await s("/auth/register",{method:"POST",body:JSON.stringify({name:e,email:t,password:a})});return r.token&&i(r.token),r},login:async(e,t)=>{let a=await s("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})});return a.token&&i(a.token),a},logout:()=>{l()},getCurrentUser:async()=>await s("/auth/me"),changePassword:async(e,t)=>await s("/auth/change-password",{method:"POST",body:JSON.stringify({currentPassword:e,newPassword:t})})},c={getAll:async()=>await s("/ingredients"),getById:async e=>await s("/ingredients/".concat(e)),create:async e=>await s("/ingredients",{method:"POST",body:JSON.stringify({name:e})}),update:async(e,t)=>await s("/ingredients/".concat(e),{method:"PUT",body:JSON.stringify({name:t})}),delete:async e=>await s("/ingredients/".concat(e),{method:"DELETE"})},d={getAll:async()=>await s("/meals"),getById:async e=>await s("/meals/".concat(e)),create:async(e,t)=>await s("/meals",{method:"POST",body:JSON.stringify({title:e,ingredients:t})}),update:async(e,t,a)=>await s("/meals/".concat(e),{method:"PUT",body:JSON.stringify({title:t,ingredients:a})}),delete:async e=>await s("/meals/".concat(e),{method:"DELETE"})},h={getAll:async()=>await s("/plans"),updateDay:async(e,t)=>await s("/plans/".concat(e),{method:"PUT",body:JSON.stringify({mealIds:t})}),reset:async()=>await s("/plans",{method:"DELETE"}),getShoppingList:async()=>await s("/plans/shopping-list")}},3885:(e,t,a)=>{"use strict";a.d(t,{B2:()=>w,DR:()=>y,Hg:()=>m,IF:()=>f,NL:()=>p,NV:()=>c,T2:()=>d,XU:()=>u,Zy:()=>o,lu:()=>h,nm:()=>x,rr:()=>g});var r=a(722);let n=[],i=[],l=[],s=()=>{let e=[],t=new Date;for(let a=0;a<7;a++){let r=new Date(t);r.setDate(t.getDate()+a),e.push({date:r.toISOString().split("T")[0],meals:[]})}return e},o=async()=>{try{return[...n=await r.cQ.getAll()]}catch(e){return console.error("Failed to fetch ingredients:",e),[]}},c=async e=>{try{let t=await r.cQ.create(e);return n.push(t),t}catch(e){throw console.error("Failed to add ingredient:",e),e}},d=async(e,t)=>{try{let a=await r.cQ.update(e,t);return n=n.map(t=>t.id===e?a:t),i=i.map(a=>({...a,ingredients:a.ingredients.map(a=>a.ingredientId===e?{...a,name:t}:a)})),a}catch(e){throw console.error("Failed to update ingredient:",e),e}},h=async e=>{try{await r.cQ.delete(e),n=n.filter(t=>t.id!==e);let t=i.find(t=>t.ingredients.some(t=>t.ingredientId===e));return{success:!t,mealWithIngredient:t}}catch(e){throw console.error("Failed to delete ingredient:",e),e}},y=async()=>{try{return[...i=await r.gw.getAll()]}catch(e){return console.error("Failed to fetch meals:",e),[]}},m=async(e,t)=>{try{let a=await r.gw.create(e,t);return i.push(a),a}catch(e){throw console.error("Failed to add meal:",e),e}},u=async(e,t,a)=>{try{let n=await r.gw.update(e,t,a);return i=i.map(t=>t.id===e?n:t),n}catch(t){throw console.error("Failed to update meal ".concat(e,":"),t),t}},g=async e=>{try{return await r.gw.delete(e),i=i.filter(t=>t.id!==e),l=l.map(t=>({...t,meals:t.meals.filter(t=>t!==e)})),{success:!0}}catch(t){throw console.error("Failed to delete meal ".concat(e,":"),t),t}},p=async()=>{try{return[...l=await r.a7.getAll()]}catch(e){return console.error("Failed to fetch meal plan:",e),0===l.length&&(l=s()),[...l]}},w=async(e,t)=>{try{let a=await r.a7.updateDay(e,t);return l=l.map(t=>t.date===e?a:t),a}catch(a){return console.error("Failed to update plan for ".concat(e,":"),a),(l=l.map(a=>a.date===e?{...a,meals:t}:a)).find(t=>t.date===e)}},f=async()=>{try{return await r.a7.reset(),l=s()}catch(e){return console.error("Failed to reset meal plan:",e),l=s()}},x=async()=>{try{return await r.a7.getShoppingList()}catch(t){console.error("Failed to fetch shopping list:",t);let e=new Map;return l.forEach(t=>{t.meals.forEach(t=>{let a=i.find(e=>e.id===t);a&&a.ingredients.forEach(t=>{if(e.has(t.ingredientId)){var a;null===(a=e.get(t.ingredientId))||void 0===a||a.quantity.push(t.quantity)}else e.set(t.ingredientId,{name:t.name,quantity:[t.quantity]})})})}),Array.from(e.entries()).map(e=>{let[t,{name:a,quantity:r}]=e;return{ingredientId:t,name:a,quantity:r.join(", ")}})}}},4944:(e,t,a)=>{Promise.resolve().then(a.bind(a,6026))},6026:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var r=a(5155),n=a(2115),i=a(3885);function l(){let[e,t]=(0,n.useState)([]),[a,l]=(0,n.useState)([]),[s,o]=(0,n.useState)(null),[c,d]=(0,n.useState)([]),[h,y]=(0,n.useState)(!1),[m,u]=(0,n.useState)(!1),[g,p]=(0,n.useState)("");(0,n.useEffect)(()=>{(async()=>{u(!0);try{let e=await (0,i.DR)();l(e);let a=await (0,i.NL)();t(a)}catch(e){console.error("Error loading data:",e),p("Failed to load data. Please try again.")}finally{u(!1)}})()},[]);let w=e=>{o(e.date),d([...e.meals]),y(!0)},f=async()=>{if(s){u(!0);try{await (0,i.B2)(s,c);let e=await (0,i.NL)();t(e),y(!1)}catch(e){console.error("Error updating plan:",e),p("Failed to update meal plan. Please try again.")}finally{u(!1)}}},x=async()=>{if(confirm("Are you sure you want to reset the entire meal plan?")){u(!0);try{await (0,i.IF)();let e=await (0,i.NL)();t(e)}catch(e){console.error("Error resetting plan:",e),p("Failed to reset meal plan. Please try again.")}finally{u(!1)}}},j=e=>{c.includes(e)?d(c.filter(t=>t!==e)):d([...c,e])},b=e=>new Date(e).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),S=e=>e.map(e=>{var t;return(null===(t=a.find(t=>t.id===e))||void 0===t?void 0:t.title)||"Unknown meal"}).join(", ");return(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{children:"Meal Plan"}),(0,r.jsx)("p",{className:"mb-4",children:"Plan your meals for the upcoming days."}),g&&(0,r.jsx)("div",{className:"card",style:{backgroundColor:"#ffebee",marginBottom:"1rem"},children:(0,r.jsx)("p",{style:{color:"var(--error-color)"},children:g})}),(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h2",{children:"Weekly Plan"}),(0,r.jsx)("button",{onClick:x,style:{backgroundColor:"var(--error-color)"},disabled:m,children:m?"Resetting...":"Reset Plan"})]}),(0,r.jsx)("div",{className:"card",children:m&&0===e.length?(0,r.jsx)("p",{children:"Loading meal plan..."}):(0,r.jsx)("div",{className:"grid",style:{gridTemplateColumns:"repeat(auto-fill, minmax(250px, 1fr))"},children:e.map(e=>(0,r.jsxs)("div",{className:"card",style:{cursor:"pointer"},onClick:()=>w(e),children:[(0,r.jsx)("h3",{children:b(e.date)}),0===e.meals.length?(0,r.jsx)("p",{style:{color:"#888"},children:"No meals planned"}):(0,r.jsx)("p",{children:S(e.meals)}),(0,r.jsx)("div",{className:"text-right mt-4",children:(0,r.jsx)("button",{className:"secondary",disabled:m,children:"Edit"})})]},e.date))})}),h&&(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:(0,r.jsxs)("div",{className:"card",style:{maxWidth:"500px",width:"100%",maxHeight:"80vh",overflow:"auto"},onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("h2",{children:["Select Meals for ",s&&b(s)]}),(0,r.jsx)("div",{className:"mb-4",style:{marginTop:"1rem"},children:0===a.length?(0,r.jsx)("p",{children:"No meals available. Create some meals first."}):(0,r.jsx)("div",{children:a.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)("input",{type:"checkbox",id:"meal-".concat(e.id),checked:c.includes(e.id),onChange:()=>j(e.id),style:{width:"auto",marginBottom:0},disabled:m}),(0,r.jsx)("label",{htmlFor:"meal-".concat(e.id),children:e.title})]},e.id))})}),(0,r.jsxs)("div",{className:"flex justify-between mt-4",children:[(0,r.jsx)("button",{className:"secondary",onClick:()=>y(!1),disabled:m,children:"Cancel"}),(0,r.jsx)("button",{onClick:f,disabled:m,children:m?"Saving...":"Save"})]})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(4944)),_N_E=e.O()}]);