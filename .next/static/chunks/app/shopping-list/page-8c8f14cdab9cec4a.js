(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[414],{722:(e,t,a)=>{"use strict";a.d(t,{R2:()=>s,a7:()=>h,cQ:()=>c,gw:()=>d});let n="lunchplanner_token",r=()=>localStorage.getItem(n),i=e=>{localStorage.setItem(n,e)},o=()=>{localStorage.removeItem(n)},l=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=r(),n={"Content-Type":"application/json",...a?{Authorization:"Bearer ".concat(a)}:{},...t.headers||{}},i=await fetch("".concat("http://localhost:3000/api").concat(e),{...t,headers:n});if(401===i.status)throw o(),window.location.href="/login",Error("Unauthorized");let l=await i.json();if(!i.ok)throw Error(l.message||"API request failed");return l},s={register:async(e,t,a)=>{let n=await l("/auth/register",{method:"POST",body:JSON.stringify({name:e,email:t,password:a})});return n.token&&i(n.token),n},login:async(e,t)=>{let a=await l("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})});return a.token&&i(a.token),a},logout:()=>{o()},getCurrentUser:async()=>await l("/auth/me"),changePassword:async(e,t)=>await l("/auth/change-password",{method:"POST",body:JSON.stringify({currentPassword:e,newPassword:t})})},c={getAll:async()=>await l("/ingredients"),getById:async e=>await l("/ingredients/".concat(e)),create:async e=>await l("/ingredients",{method:"POST",body:JSON.stringify({name:e})}),update:async(e,t)=>await l("/ingredients/".concat(e),{method:"PUT",body:JSON.stringify({name:t})}),delete:async e=>await l("/ingredients/".concat(e),{method:"DELETE"})},d={getAll:async()=>await l("/meals"),getById:async e=>await l("/meals/".concat(e)),create:async(e,t)=>await l("/meals",{method:"POST",body:JSON.stringify({title:e,ingredients:t})}),update:async(e,t,a)=>await l("/meals/".concat(e),{method:"PUT",body:JSON.stringify({title:t,ingredients:a})}),delete:async e=>await l("/meals/".concat(e),{method:"DELETE"})},h={getAll:async()=>await l("/plans"),updateDay:async(e,t)=>await l("/plans/".concat(e),{method:"PUT",body:JSON.stringify({mealIds:t})}),reset:async()=>await l("/plans",{method:"DELETE"}),getShoppingList:async()=>await l("/plans/shopping-list")}},1414:(e,t,a)=>{Promise.resolve().then(a.bind(a,7808))},3885:(e,t,a)=>{"use strict";a.d(t,{B2:()=>w,DR:()=>y,Hg:()=>g,IF:()=>f,NL:()=>p,NV:()=>c,T2:()=>d,XU:()=>u,Zy:()=>s,lu:()=>h,nm:()=>x,rr:()=>m});var n=a(722);let r=[],i=[],o=[],l=()=>{let e=[],t=new Date;for(let a=0;a<7;a++){let n=new Date(t);n.setDate(t.getDate()+a),e.push({date:n.toISOString().split("T")[0],meals:[]})}return e},s=async()=>{try{return[...r=await n.cQ.getAll()]}catch(e){return console.error("Failed to fetch ingredients:",e),[]}},c=async e=>{try{let t=await n.cQ.create(e);return r.push(t),t}catch(e){throw console.error("Failed to add ingredient:",e),e}},d=async(e,t)=>{try{let a=await n.cQ.update(e,t);return r=r.map(t=>t.id===e?a:t),i=i.map(a=>({...a,ingredients:a.ingredients.map(a=>a.ingredientId===e?{...a,name:t}:a)})),a}catch(e){throw console.error("Failed to update ingredient:",e),e}},h=async e=>{try{await n.cQ.delete(e),r=r.filter(t=>t.id!==e);let t=i.find(t=>t.ingredients.some(t=>t.ingredientId===e));return{success:!t,mealWithIngredient:t}}catch(e){throw console.error("Failed to delete ingredient:",e),e}},y=async()=>{try{return[...i=await n.gw.getAll()]}catch(e){return console.error("Failed to fetch meals:",e),[]}},g=async(e,t)=>{try{let a=await n.gw.create(e,t);return i.push(a),a}catch(e){throw console.error("Failed to add meal:",e),e}},u=async(e,t,a)=>{try{let r=await n.gw.update(e,t,a);return i=i.map(t=>t.id===e?r:t),r}catch(t){throw console.error("Failed to update meal ".concat(e,":"),t),t}},m=async e=>{try{return await n.gw.delete(e),i=i.filter(t=>t.id!==e),o=o.map(t=>({...t,meals:t.meals.filter(t=>t!==e)})),{success:!0}}catch(t){throw console.error("Failed to delete meal ".concat(e,":"),t),t}},p=async()=>{try{return[...o=await n.a7.getAll()]}catch(e){return console.error("Failed to fetch meal plan:",e),0===o.length&&(o=l()),[...o]}},w=async(e,t)=>{try{let a=await n.a7.updateDay(e,t);return o=o.map(t=>t.date===e?a:t),a}catch(a){return console.error("Failed to update plan for ".concat(e,":"),a),(o=o.map(a=>a.date===e?{...a,meals:t}:a)).find(t=>t.date===e)}},f=async()=>{try{return await n.a7.reset(),o=l()}catch(e){return console.error("Failed to reset meal plan:",e),o=l()}},x=async()=>{try{return await n.a7.getShoppingList()}catch(t){console.error("Failed to fetch shopping list:",t);let e=new Map;return o.forEach(t=>{t.meals.forEach(t=>{let a=i.find(e=>e.id===t);a&&a.ingredients.forEach(t=>{if(e.has(t.ingredientId)){var a;null===(a=e.get(t.ingredientId))||void 0===a||a.quantity.push(t.quantity)}else e.set(t.ingredientId,{name:t.name,quantity:[t.quantity]})})})}),Array.from(e.entries()).map(e=>{let[t,{name:a,quantity:n}]=e;return{ingredientId:t,name:a,quantity:n.join(", ")}})}}},7808:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var n=a(5155),r=a(2115),i=a(3885);function o(){let[e,t]=(0,r.useState)([]),[a,o]=(0,r.useState)([]),[l,s]=(0,r.useState)([]),[c,d]=(0,r.useState)({}),[h,y]=(0,r.useState)(!1),[g,u]=(0,r.useState)("");(0,r.useEffect)(()=>{(async()=>{y(!0);try{let e=await (0,i.nm)();t(e);let a=await (0,i.NL)();o(a);let n=await (0,i.DR)();s(n)}catch(e){console.error("Error loading data:",e),u("Failed to load data. Please try again.")}finally{y(!1)}})()},[]);let m=e=>{d({...c,[e]:!c[e]})},p=e=>new Date(e).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),w=e=>e.map(e=>{var t;return(null===(t=l.find(t=>t.id===e))||void 0===t?void 0:t.title)||"Unknown meal"});return(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{children:"Shopping List"}),(0,n.jsx)("p",{className:"mb-4",children:"Based on your meal plan, here's what you need to buy."}),g&&(0,n.jsx)("div",{className:"card",style:{backgroundColor:"#ffebee",marginBottom:"1rem"},children:(0,n.jsx)("p",{style:{color:"var(--error-color)"},children:g})}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h2",{children:"Your Shopping List"}),(0,n.jsx)("button",{onClick:()=>{let t=window.open("","_blank");if(!t)return;let a="\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <title>Shopping List</title>\n        <style>\n          body { font-family: Arial, sans-serif; margin: 20px; }\n          h1 { margin-bottom: 20px; }\n          ul { padding-left: 20px; }\n          li { margin-bottom: 8px; }\n        </style>\n      </head>\n      <body>\n        <h1>Shopping List</h1>\n        <ul>\n          ".concat(e.map(e=>"<li>".concat(e.name,": ").concat(e.quantity,"</li>")).join(""),"\n        </ul>\n      </body>\n      </html>\n    ");t.document.open(),t.document.write(a),t.document.close(),t.print()},disabled:h||0===e.length,children:"Print List"})]}),h?(0,n.jsx)("p",{children:"Loading shopping list..."}):0===e.length?(0,n.jsx)("div",{children:(0,n.jsx)("p",{children:"Your shopping list is empty. Add meals to your meal plan first."})}):(0,n.jsx)("ul",{style:{listStyle:"none",padding:0},children:e.map(e=>(0,n.jsxs)("li",{className:"flex items-center gap-2 p-4",style:{borderBottom:"1px solid var(--border-color)",textDecoration:c[e.ingredientId]?"line-through":"none",opacity:c[e.ingredientId]?.5:1},children:[(0,n.jsx)("input",{type:"checkbox",checked:!!c[e.ingredientId],onChange:()=>m(e.ingredientId),style:{width:"auto",marginBottom:0}}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("strong",{children:[e.name,":"]})," ",e.quantity]})]},e.ingredientId))})]}),(0,n.jsxs)("div",{className:"card mt-4",children:[(0,n.jsx)("h2",{children:"Meal Plan Summary"}),h?(0,n.jsx)("p",{children:"Loading meal plan..."}):0===a.filter(e=>e.meals.length>0).length?(0,n.jsx)("p",{children:"No meals planned yet."}):(0,n.jsx)("ul",{children:a.map(e=>e.meals.length>0&&(0,n.jsxs)("li",{style:{marginBottom:"10px"},children:[(0,n.jsxs)("strong",{children:[p(e.date),":"]})," ",w(e.meals).join(", ")]},e.date))})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(1414)),_N_E=e.O()}]);