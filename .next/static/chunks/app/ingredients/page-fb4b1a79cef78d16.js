(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[653],{722:(e,t,n)=>{"use strict";n.d(t,{R2:()=>o,a7:()=>h,cQ:()=>c,gw:()=>d});let a="lunchplanner_token",r=()=>localStorage.getItem(a),i=e=>{localStorage.setItem(a,e)},l=()=>{localStorage.removeItem(a)},s=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r(),a={"Content-Type":"application/json",...n?{Authorization:"Bearer ".concat(n)}:{},...t.headers||{}},i=await fetch("".concat("http://localhost:3000/api").concat(e),{...t,headers:a});if(401===i.status)throw l(),window.location.href="/login",Error("Unauthorized");let s=await i.json();if(!i.ok)throw Error(s.message||"API request failed");return s},o={register:async(e,t,n)=>{let a=await s("/auth/register",{method:"POST",body:JSON.stringify({name:e,email:t,password:n})});return a.token&&i(a.token),a},login:async(e,t)=>{let n=await s("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})});return n.token&&i(n.token),n},logout:()=>{l()},getCurrentUser:async()=>await s("/auth/me"),changePassword:async(e,t)=>await s("/auth/change-password",{method:"POST",body:JSON.stringify({currentPassword:e,newPassword:t})})},c={getAll:async()=>await s("/ingredients"),getById:async e=>await s("/ingredients/".concat(e)),create:async e=>await s("/ingredients",{method:"POST",body:JSON.stringify({name:e})}),update:async(e,t)=>await s("/ingredients/".concat(e),{method:"PUT",body:JSON.stringify({name:t})}),delete:async e=>await s("/ingredients/".concat(e),{method:"DELETE"})},d={getAll:async()=>await s("/meals"),getById:async e=>await s("/meals/".concat(e)),create:async(e,t)=>await s("/meals",{method:"POST",body:JSON.stringify({title:e,ingredients:t})}),update:async(e,t,n)=>await s("/meals/".concat(e),{method:"PUT",body:JSON.stringify({title:t,ingredients:n})}),delete:async e=>await s("/meals/".concat(e),{method:"DELETE"})},h={getAll:async()=>await s("/plans"),updateDay:async(e,t)=>await s("/plans/".concat(e),{method:"PUT",body:JSON.stringify({mealIds:t})}),reset:async()=>await s("/plans",{method:"DELETE"}),getShoppingList:async()=>await s("/plans/shopping-list")}},3315:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var a=n(5155),r=n(2115),i=n(3885),l=n(7153);function s(){let[e,t]=(0,r.useState)([]),[n,s]=(0,r.useState)(""),[o,c]=(0,r.useState)(null),[d,h]=(0,r.useState)(""),[u,g]=(0,r.useState)(""),[y,m]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{m(!0);try{let e=await (0,i.Zy)();t(e)}catch(e){g("Failed to load ingredients"),console.error(e)}finally{m(!1)}})()},[]);let p=async()=>{if(!n.trim()){g("Ingredient name cannot be empty");return}m(!0);try{await (0,i.NV)(n.trim());let e=await (0,i.Zy)();t(e),s(""),g("")}catch(e){g("Failed to add ingredient"),console.error(e)}finally{m(!1)}},f=e=>{c(e.id),h(e.name),g("")},w=()=>{c(null),h(""),g("")},x=async e=>{if(!d.trim()){g("Ingredient name cannot be empty");return}m(!0);try{await (0,i.T2)(e,d.trim());let n=await (0,i.Zy)();t(n),c(null),g("")}catch(e){g("Failed to update ingredient"),console.error(e)}finally{m(!1)}},j=async e=>{m(!0);try{let a=await (0,i.lu)(e);if(!a.success){var n;g("Cannot delete ingredient that is used in meal: ".concat(null===(n=a.mealWithIngredient)||void 0===n?void 0:n.title));return}let r=await (0,i.Zy)();t(r),g("")}catch(e){g("Failed to delete ingredient"),console.error(e)}finally{m(!1)}};return(0,a.jsx)(l.A,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{children:"Ingredients"}),(0,a.jsx)("p",{className:"mb-4",children:"Manage your ingredients database."}),u&&(0,a.jsx)("div",{className:"card",style:{backgroundColor:"#ffebee",marginBottom:"1rem"},children:(0,a.jsx)("p",{style:{color:"var(--error-color)"},children:u})}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h2",{children:"Add New Ingredient"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:n,onChange:e=>s(e.target.value),placeholder:"Enter ingredient name",style:{marginBottom:0},disabled:y}),(0,a.jsx)("button",{onClick:p,disabled:y,children:y?"Adding...":"Add"})]})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h2",{children:"Ingredients List"}),y&&0===e.length?(0,a.jsx)("p",{children:"Loading ingredients..."}):0===e.length?(0,a.jsx)("p",{children:"No ingredients added yet."}):(0,a.jsx)("ul",{style:{listStyle:"none"},children:e.map(e=>(0,a.jsx)("li",{className:"flex justify-between items-center",style:{padding:"0.75rem 0",borderBottom:"1px solid var(--border-color)"},children:o===e.id?(0,a.jsxs)("div",{className:"flex gap-2",style:{width:"100%"},children:[(0,a.jsx)("input",{type:"text",value:d,onChange:e=>h(e.target.value),style:{marginBottom:0},disabled:y}),(0,a.jsx)("button",{onClick:()=>x(e.id),disabled:y,children:y?"Saving...":"Save"}),(0,a.jsx)("button",{className:"secondary",onClick:w,disabled:y,children:"Cancel"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:e.name}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"secondary",onClick:()=>f(e),disabled:y,children:"Edit"}),(0,a.jsx)("button",{style:{backgroundColor:"var(--error-color)"},onClick:()=>j(e.id),disabled:y,children:y?"Deleting...":"Delete"})]})]})},e.id))})]})]})})}},3479:(e,t,n)=>{Promise.resolve().then(n.bind(n,3315))},3885:(e,t,n)=>{"use strict";n.d(t,{B2:()=>f,DR:()=>u,Hg:()=>g,IF:()=>w,NL:()=>p,NV:()=>c,T2:()=>d,XU:()=>y,Zy:()=>o,lu:()=>h,nm:()=>x,rr:()=>m});var a=n(722);let r=[],i=[],l=[],s=()=>{let e=[],t=new Date;for(let n=0;n<7;n++){let a=new Date(t);a.setDate(t.getDate()+n),e.push({date:a.toISOString().split("T")[0],meals:[]})}return e},o=async()=>{try{return[...r=await a.cQ.getAll()]}catch(e){return console.error("Failed to fetch ingredients:",e),[]}},c=async e=>{try{let t=await a.cQ.create(e);return r.push(t),t}catch(e){throw console.error("Failed to add ingredient:",e),e}},d=async(e,t)=>{try{let n=await a.cQ.update(e,t);return r=r.map(t=>t.id===e?n:t),i=i.map(n=>({...n,ingredients:n.ingredients.map(n=>n.ingredientId===e?{...n,name:t}:n)})),n}catch(e){throw console.error("Failed to update ingredient:",e),e}},h=async e=>{try{await a.cQ.delete(e),r=r.filter(t=>t.id!==e);let t=i.find(t=>t.ingredients.some(t=>t.ingredientId===e));return{success:!t,mealWithIngredient:t}}catch(e){throw console.error("Failed to delete ingredient:",e),e}},u=async()=>{try{return[...i=await a.gw.getAll()]}catch(e){return console.error("Failed to fetch meals:",e),[]}},g=async(e,t)=>{try{let n=await a.gw.create(e,t);return i.push(n),n}catch(e){throw console.error("Failed to add meal:",e),e}},y=async(e,t,n)=>{try{let r=await a.gw.update(e,t,n);return i=i.map(t=>t.id===e?r:t),r}catch(t){throw console.error("Failed to update meal ".concat(e,":"),t),t}},m=async e=>{try{return await a.gw.delete(e),i=i.filter(t=>t.id!==e),l=l.map(t=>({...t,meals:t.meals.filter(t=>t!==e)})),{success:!0}}catch(t){throw console.error("Failed to delete meal ".concat(e,":"),t),t}},p=async()=>{try{return[...l=await a.a7.getAll()]}catch(e){return console.error("Failed to fetch meal plan:",e),0===l.length&&(l=s()),[...l]}},f=async(e,t)=>{try{let n=await a.a7.updateDay(e,t);return l=l.map(t=>t.date===e?n:t),n}catch(n){return console.error("Failed to update plan for ".concat(e,":"),n),(l=l.map(n=>n.date===e?{...n,meals:t}:n)).find(t=>t.date===e)}},w=async()=>{try{return await a.a7.reset(),l=s()}catch(e){return console.error("Failed to reset meal plan:",e),l=s()}},x=async()=>{try{return await a.a7.getShoppingList()}catch(t){console.error("Failed to fetch shopping list:",t);let e=new Map;return l.forEach(t=>{t.meals.forEach(t=>{let n=i.find(e=>e.id===t);n&&n.ingredients.forEach(t=>{if(e.has(t.ingredientId)){var n;null===(n=e.get(t.ingredientId))||void 0===n||n.quantity.push(t.quantity)}else e.set(t.ingredientId,{name:t.name,quantity:[t.quantity]})})})}),Array.from(e.entries()).map(e=>{let[t,{name:n,quantity:a}]=e;return{ingredientId:t,name:n,quantity:a.join(", ")}})}}},7153:(e,t,n)=>{"use strict";n.d(t,{A:()=>h});var a=n(5155),r=n(6874),i=n.n(r),l=n(5695),s=n(722);function o(){let e=(0,l.usePathname)();return(0,a.jsx)("header",{className:"p-4",style:{backgroundColor:"white",borderBottom:"1px solid var(--border-color)"},children:(0,a.jsxs)("div",{className:"container flex justify-between items-center",children:[(0,a.jsx)("h1",{style:{margin:0,fontSize:"1.5rem"},children:"\uD83C\uDF7D️ Lunch Planner"}),(0,a.jsx)("nav",{children:(0,a.jsxs)("ul",{className:"flex gap-4",style:{listStyle:"none",margin:0},children:[(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:"/",style:{fontWeight:"/"===e?"bold":"normal",textDecoration:"/"===e?"underline":"none"},children:"Home"})}),(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:"/ingredients",style:{fontWeight:"/ingredients"===e?"bold":"normal",textDecoration:"/ingredients"===e?"underline":"none"},children:"Ingredients"})}),(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:"/meals",style:{fontWeight:"/meals"===e?"bold":"normal",textDecoration:"/meals"===e?"underline":"none"},children:"Meals"})}),(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:"/plan",style:{fontWeight:"/plan"===e?"bold":"normal",textDecoration:"/plan"===e?"underline":"none"},children:"Meal Plan"})}),(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:"/shopping-list",style:{fontWeight:"/shopping-list"===e?"bold":"normal",textDecoration:"/shopping-list"===e?"underline":"none"},children:"Shopping List"})}),(0,a.jsx)("li",{children:(0,a.jsx)("button",{onClick:()=>{s.R2.logout(),window.location.href="/login"},className:"link-button",children:"Logout"})})]})})]})})}var c=n(2115);function d(e){let{children:t}=e,[n,r]=(0,c.useState)(!0),i=(0,l.useRouter)();return((0,c.useEffect)(()=>{(async()=>{try{await s.R2.getCurrentUser(),r(!1)}catch(e){i.push("/login")}})()},[i]),n)?(0,a.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,a.jsx)("p",{children:"Loading..."})}):(0,a.jsx)(a.Fragment,{children:t})}function h(e){let{children:t}=e;return(0,a.jsxs)(d,{children:[(0,a.jsx)(o,{}),(0,a.jsx)("main",{className:"container p-4",children:t})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[244,441,684,358],()=>t(3479)),_N_E=e.O()}]);