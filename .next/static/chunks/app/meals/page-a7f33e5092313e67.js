(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[697],{722:(e,t,a)=>{"use strict";a.d(t,{R2:()=>d,a7:()=>h,cQ:()=>c,gw:()=>o});let n="lunchplanner_token",i=()=>localStorage.getItem(n),r=e=>{localStorage.setItem(n,e)},l=()=>{localStorage.removeItem(n)},s=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i(),n={"Content-Type":"application/json",...a?{Authorization:"Bearer ".concat(a)}:{},...t.headers||{}},r=await fetch("".concat("http://localhost:3000/api").concat(e),{...t,headers:n});if(401===r.status)throw l(),window.location.href="/login",Error("Unauthorized");let s=await r.json();if(!r.ok)throw Error(s.message||"API request failed");return s},d={register:async(e,t,a)=>{let n=await s("/auth/register",{method:"POST",body:JSON.stringify({name:e,email:t,password:a})});return n.token&&r(n.token),n},login:async(e,t)=>{let a=await s("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})});return a.token&&r(a.token),a},logout:()=>{l()},getCurrentUser:async()=>await s("/auth/me"),changePassword:async(e,t)=>await s("/auth/change-password",{method:"POST",body:JSON.stringify({currentPassword:e,newPassword:t})})},c={getAll:async()=>await s("/ingredients"),getById:async e=>await s("/ingredients/".concat(e)),create:async e=>await s("/ingredients",{method:"POST",body:JSON.stringify({name:e})}),update:async(e,t)=>await s("/ingredients/".concat(e),{method:"PUT",body:JSON.stringify({name:t})}),delete:async e=>await s("/ingredients/".concat(e),{method:"DELETE"})},o={getAll:async()=>await s("/meals"),getById:async e=>await s("/meals/".concat(e)),create:async(e,t)=>await s("/meals",{method:"POST",body:JSON.stringify({title:e,ingredients:t})}),update:async(e,t,a)=>await s("/meals/".concat(e),{method:"PUT",body:JSON.stringify({title:t,ingredients:a})}),delete:async e=>await s("/meals/".concat(e),{method:"DELETE"})},h={getAll:async()=>await s("/plans"),updateDay:async(e,t)=>await s("/plans/".concat(e),{method:"PUT",body:JSON.stringify({mealIds:t})}),reset:async()=>await s("/plans",{method:"DELETE"}),getShoppingList:async()=>await s("/plans/shopping-list")}},3885:(e,t,a)=>{"use strict";a.d(t,{B2:()=>w,DR:()=>u,Hg:()=>g,IF:()=>f,NL:()=>p,NV:()=>c,T2:()=>o,XU:()=>y,Zy:()=>d,lu:()=>h,nm:()=>x,rr:()=>m});var n=a(722);let i=[],r=[],l=[],s=()=>{let e=[],t=new Date;for(let a=0;a<7;a++){let n=new Date(t);n.setDate(t.getDate()+a),e.push({date:n.toISOString().split("T")[0],meals:[]})}return e},d=async()=>{try{return[...i=await n.cQ.getAll()]}catch(e){return console.error("Failed to fetch ingredients:",e),[]}},c=async e=>{try{let t=await n.cQ.create(e);return i.push(t),t}catch(e){throw console.error("Failed to add ingredient:",e),e}},o=async(e,t)=>{try{let a=await n.cQ.update(e,t);return i=i.map(t=>t.id===e?a:t),r=r.map(a=>({...a,ingredients:a.ingredients.map(a=>a.ingredientId===e?{...a,name:t}:a)})),a}catch(e){throw console.error("Failed to update ingredient:",e),e}},h=async e=>{try{await n.cQ.delete(e),i=i.filter(t=>t.id!==e);let t=r.find(t=>t.ingredients.some(t=>t.ingredientId===e));return{success:!t,mealWithIngredient:t}}catch(e){throw console.error("Failed to delete ingredient:",e),e}},u=async()=>{try{return[...r=await n.gw.getAll()]}catch(e){return console.error("Failed to fetch meals:",e),[]}},g=async(e,t)=>{try{let a=await n.gw.create(e,t);return r.push(a),a}catch(e){throw console.error("Failed to add meal:",e),e}},y=async(e,t,a)=>{try{let i=await n.gw.update(e,t,a);return r=r.map(t=>t.id===e?i:t),i}catch(t){throw console.error("Failed to update meal ".concat(e,":"),t),t}},m=async e=>{try{return await n.gw.delete(e),r=r.filter(t=>t.id!==e),l=l.map(t=>({...t,meals:t.meals.filter(t=>t!==e)})),{success:!0}}catch(t){throw console.error("Failed to delete meal ".concat(e,":"),t),t}},p=async()=>{try{return[...l=await n.a7.getAll()]}catch(e){return console.error("Failed to fetch meal plan:",e),0===l.length&&(l=s()),[...l]}},w=async(e,t)=>{try{let a=await n.a7.updateDay(e,t);return l=l.map(t=>t.date===e?a:t),a}catch(a){return console.error("Failed to update plan for ".concat(e,":"),a),(l=l.map(a=>a.date===e?{...a,meals:t}:a)).find(t=>t.date===e)}},f=async()=>{try{return await n.a7.reset(),l=s()}catch(e){return console.error("Failed to reset meal plan:",e),l=s()}},x=async()=>{try{return await n.a7.getShoppingList()}catch(t){console.error("Failed to fetch shopping list:",t);let e=new Map;return l.forEach(t=>{t.meals.forEach(t=>{let a=r.find(e=>e.id===t);a&&a.ingredients.forEach(t=>{if(e.has(t.ingredientId)){var a;null===(a=e.get(t.ingredientId))||void 0===a||a.quantity.push(t.quantity)}else e.set(t.ingredientId,{name:t.name,quantity:[t.quantity]})})})}),Array.from(e.entries()).map(e=>{let[t,{name:a,quantity:n}]=e;return{ingredientId:t,name:a,quantity:n.join(", ")}})}}},7635:(e,t,a)=>{Promise.resolve().then(a.bind(a,8927))},8927:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var n=a(5155),i=a(2115),r=a(3885);function l(){let[e,t]=(0,i.useState)([]),[a,l]=(0,i.useState)([]),[s,d]=(0,i.useState)(null),[c,o]=(0,i.useState)(!1),[h,u]=(0,i.useState)(!1),[g,y]=(0,i.useState)(""),[m,p]=(0,i.useState)([]),[w,f]=(0,i.useState)(""),[x,j]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{j(!0);try{let e=await (0,r.DR)();t(e);let a=await (0,r.Zy)();l(a)}catch(e){console.error("Error loading data:",e),f("Failed to load data. Please try again.")}finally{j(!1)}})()},[]);let b=()=>{y(""),p([]),d(null),o(!1),u(!1),f("")},v=e=>{d(e),y(e.title),p([...e.ingredients]),o(!0),u(!0)},N=(e,t,n)=>{let i=[...m];if("ingredientId"===t){let t=a.find(e=>e.id===n);i[e]={...i[e],ingredientId:n,name:(null==t?void 0:t.name)||""}}else i[e]={...i[e],[t]:n};p(i)},S=e=>{let t=[...m];t.splice(e,1),p(t)},I=async()=>{if(!g.trim()){f("Meal title cannot be empty");return}if(0===m.length){f("Meal must have at least one ingredient");return}if(m.find(e=>!e.ingredientId||!e.quantity.trim())){f("All ingredients must have a selected ingredient and quantity");return}j(!0);try{c&&s?await (0,r.XU)(s.id,g.trim(),m.map(e=>({ingredientId:e.ingredientId,quantity:e.quantity.trim()}))):await (0,r.Hg)(g.trim(),m.map(e=>({ingredientId:e.ingredientId,quantity:e.quantity.trim()})));let e=await (0,r.DR)();t(e),b()}catch(e){console.error("Error saving meal:",e),f("Failed to save meal. Please try again.")}finally{j(!1)}},E=async e=>{if(confirm("Are you sure you want to delete this meal?")){j(!0);try{await (0,r.rr)(e);let a=await (0,r.DR)();t(a)}catch(e){console.error("Error deleting meal:",e),f("Failed to delete meal. Please try again.")}finally{j(!1)}}};return(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{children:"Meals"}),(0,n.jsx)("p",{className:"mb-4",children:"Create and manage your meals with ingredients."}),w&&(0,n.jsx)("div",{className:"card",style:{backgroundColor:"#ffebee",marginBottom:"1rem"},children:(0,n.jsx)("p",{style:{color:"var(--error-color)"},children:w})}),(0,n.jsxs)("div",{className:"card",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)("h2",{children:"Meals List"}),(0,n.jsx)("button",{onClick:()=>{b(),u(!0)},disabled:x,children:"Add New Meal"})]}),h&&(0,n.jsxs)("div",{className:"card",style:{backgroundColor:"#f5f5f5"},children:[(0,n.jsx)("h3",{children:c?"Edit Meal":"Add New Meal"}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)("label",{htmlFor:"mealTitle",children:"Meal Title"}),(0,n.jsx)("input",{id:"mealTitle",type:"text",value:g,onChange:e=>y(e.target.value),placeholder:"Enter meal title",disabled:x})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("h4",{children:"Ingredients"}),(0,n.jsx)("button",{className:"secondary",onClick:()=>{p([...m,{ingredientId:"",name:"",quantity:""}])},disabled:x,children:"Add Ingredient"})]}),0===m.length?(0,n.jsx)("p",{children:"No ingredients added yet."}):(0,n.jsx)("ul",{style:{listStyle:"none",padding:0},children:m.map((e,t)=>(0,n.jsxs)("li",{className:"flex gap-2 mb-2",children:[(0,n.jsxs)("select",{value:e.ingredientId,onChange:e=>N(t,"ingredientId",e.target.value),style:{flex:2},disabled:x,children:[(0,n.jsx)("option",{value:"",children:"Select an ingredient"}),a.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,n.jsx)("input",{type:"text",value:e.quantity,onChange:e=>N(t,"quantity",e.target.value),placeholder:"Quantity (e.g., '2 cups')",style:{flex:1,marginBottom:0},disabled:x}),(0,n.jsx)("button",{style:{backgroundColor:"var(--error-color)"},onClick:()=>S(t),disabled:x,children:"X"})]},t))})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:I,disabled:x,children:x?"Saving...":c?"Update Meal":"Create Meal"}),(0,n.jsx)("button",{className:"secondary",onClick:b,disabled:x,children:"Cancel"})]})]}),x&&0===e.length?(0,n.jsx)("p",{children:"Loading meals..."}):0===e.length?(0,n.jsx)("p",{children:"No meals created yet."}):(0,n.jsx)("div",{className:"grid",children:e.map(e=>(0,n.jsxs)("div",{className:"card",children:[(0,n.jsx)("h3",{children:e.title}),(0,n.jsx)("h4",{children:"Ingredients:"}),(0,n.jsx)("ul",{style:{marginBottom:"1rem"},children:e.ingredients.map((e,t)=>(0,n.jsxs)("li",{children:[e.name,": ",e.quantity]},t))}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{className:"secondary",onClick:()=>v(e),disabled:x,children:"Edit"}),(0,n.jsx)("button",{style:{backgroundColor:"var(--error-color)"},onClick:()=>E(e.id),disabled:x,children:x?"Deleting...":"Delete"})]})]},e.id))})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(7635)),_N_E=e.O()}]);